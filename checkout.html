<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - EDTECH SYSTEMS</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <h1>TECHFLOW SYSTEMS</h1>
    <div>
      <a href="index.html">Home</a>
      <a href="electronics.html">Electronics</a>
      <a href="checkout.html" id="goToCheckout">Cart</a>
    </div>
  </nav>

  <!-- Checkout Container -->
  <div class="checkout-container">
    <h2>Shopping Cart</h2>
    <div class="checkout-wrapper">
      <!-- Cart Items -->
      <div class="cart-items">
        <h2>Your Items</h2>
        <div id="cartItemsContainer"></div>
      </div>

      <!-- Order Summary -->
      <div class="checkout-summary">
        <h3>Order Summary</h3>
        <div class="summary-row">
          <span>Subtotal:</span>
          <span id="subtotal">KSh 0</span>
        </div>
        <div class="summary-total">
          <span>Total:</span>
          <span id="total">KSh 0</span>
        </div>
        <button class="checkout-btn" id="checkoutBtn">Complete Purchase</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 EDTECH SYSTEMS | Contact: ewairagu@gmail.com</p>
  </footer>

  <script>
    // Format numbers as Kenyan Shillings
    function formatKsh(amount) {
      return 'KSh ' + Number(amount).toLocaleString('en-KE', { maximumFractionDigits: 0 });
    }

    function getCart() {
      return JSON.parse(localStorage.getItem('cart')) || [];
    }

    function saveCart(cart) {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    document.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('cartItemsContainer');
      const subtotalEl = document.getElementById('subtotal');
      const totalEl = document.getElementById('total');
      const checkoutBtn = document.getElementById('checkoutBtn');

      function renderCart() {
        const cart = getCart();
        if (!cart || cart.length === 0) {
          container.innerHTML = '<div class="empty-cart"><p>Your cart is empty</p><a href="electronics.html" class="cta-btn">Continue Shopping</a></div>';
          updateSummary([]);
          return;
        }

        container.innerHTML = cart.map(item => `
          <div class="cart-item" data-key="${item.key}">
            <div class="cart-item-info">
              <div class="cart-item-name">${item.brand ? item.brand + ' ' : ''}${item.name}</div>
              <div class="cart-item-price">${formatKsh(item.price)}</div>
              <div class="cart-item-controls" style="margin-top:8px;">
                <button class="qty-btn" data-action="decrease" aria-label="Decrease quantity">âˆ’</button>
                <span class="qty" style="margin:0 8px">${item.qty}</span>
                <button class="qty-btn" data-action="increase" aria-label="Increase quantity">+</button>
                <button class="cart-item-remove" data-action="remove" style="margin-left:12px;background:#dc3545;color:#fff;padding:6px;border-radius:4px;border:none;cursor:pointer;">Remove</button>
              </div>
            </div>
          </div>
        `).join('');

        updateSummary(cart);
      }

      function updateSummary(cartItems) {
        const subtotal = (cartItems || getCart()).reduce((sum, it) => sum + Number(it.price) * Number(it.qty), 0);
        const total = subtotal; // taxes removed
        subtotalEl.textContent = formatKsh(subtotal);
        totalEl.textContent = formatKsh(total);
      }

      // Delegated click handler: qty changes and remove
      container.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const action = btn.dataset.action;
        const itemEl = btn.closest('.cart-item');
        if (!itemEl) return;
        const key = itemEl.dataset.key;
        let cart = getCart();
        const idx = cart.findIndex(i => i.key === key);
        if (idx === -1) return;

        if (action === 'increase') {
          cart[idx].qty = Number(cart[idx].qty) + 1;
        } else if (action === 'decrease') {
          cart[idx].qty = Math.max(1, Number(cart[idx].qty) - 1);
        } else if (action === 'remove') {
          cart.splice(idx, 1);
        }
        saveCart(cart);
        renderCart();
      });

      // Checkout button
      checkoutBtn.addEventListener('click', () => {
        const cart = getCart();
        if (!cart || cart.length === 0) {
          alert('Your cart is empty.');
          return;
        }
        // Placeholder: call backend/checkout flow here
        alert('Order placed successfully!');
        localStorage.removeItem('cart');
        renderCart();
      });

      // init
      renderCart();
    });
  </script>
</body>
</html>